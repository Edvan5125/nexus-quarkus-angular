<!-- layout principal com barra lateral e area de conversa -->
<div class="caixa-chat">

  <!-- barra lateral com botoes -->
  <aside class="barra-lateral">
    <div class="menu">
      <button class="botao-editar">‚úé</button>
      <button class="botao-config">‚öô</button>
    </div>
  </aside>

  <!-- area principal onde ficam as mensagens -->
  <main class="area-conversa">
    <header class="cabecalho-conversa">
      <div class="cabecalho-esquerda">
  <!-- logotipo simples do app -->
  <div class="logo-titulo">NEXUS</div>
      </div>

      <div class="cabecalho-direita">
        <div class="perfil" role="region" aria-label="perfil">
          <div class="perfil-info">
          
          </div>
          <!-- botao que abre o bloco com detalhes do usuario -->
          <button class="botao-perfil" (click)="togglePerfil()" aria-expanded="{{showPerfil}}" aria-controls="bloco-perfil">üë§</button>

          <!-- bloco com dados do perfil aparece quando showperfil esta ativo -->
          @if (showPerfil) {
          <div id="bloco-perfil" class="bloco-perfil" role="dialog" aria-modal="false">
            <div class="conteudo-bloco">
              <div class="titulo-bloco">Meu Perfil</div>
              <div class="item-bloco"><strong>Usu√°rio:</strong> {{ userNome }}</div>
              <div class="item-bloco"><strong>E-mail:</strong> {{ userEmail }}</div>
              <div class="acoes-bloco">
                <button class="botao-fechar" (click)="fecharPerfil()">Fechar</button>
              </div>
            </div>
          </div>
          }
        </div>
      </div>
    </header>

  <!-- lista onde as mensagens sao mostradas -->
  <div class="lista-mensagens" #mensagensArea (mouseup)="onMouseUpMensagens($event)">
      <div
        *ngFor="let msg of mensagem; trackBy: trackByIndex"
        [ngClass]="msg.sender"
      >
  <!-- se for mensagem do tipo digitando mostra uma animacao -->
        @if (msg.typing) {
          <p><strong>NexusBot:</strong> <span class="typing">digitando</span></p>
        } @else {
          @if (msg.tipo === 'balao-acao') {
            <div class="balao-analise">
              <div class="balao-topo">
                <span class="balao-titulo">An√°lise do Texto</span>
              </div>
              <div class="balao-corpo">
                <div class="balao-acoes">
                  <button (click)="resumirTextoAlvo(msg)">Resumir texto</button>
                  <div class="definir-inline">
                    <input [(ngModel)]="msg.palavra" placeholder="Palavra" />
                    <button (click)="definirPalavraBalao(msg)">Definir</button>
                  </div>
                  <span class="dica">Dica: selecione trechos nas mensagens para Grifar ou abrir Defini√ß√£o.</span>
                </div>
                @if (msg.resumo) {
                  <div class="balao-bloco">
                    <h4>Resumo</h4>
                    <p>{{ msg.resumo }}</p>
                  </div>
                }
                @if (msg.definicao) {
                  <div class="balao-bloco">
                    <h4>Defini√ß√£o</h4>
                    <p>{{ msg.definicao }}</p>
                    @if (msg.sinonimos?.length) {
                      <div class="sinonimos">
                        <span>Sin√¥nimos:</span>
                        <ul>
                          <li *ngFor="let s of msg.sinonimos">{{ s }}</li>
                        </ul>
                      </div>
                    }
                  </div>
                }
              </div>
            </div>
          } @else {
            <p><strong>{{ msg.sender === 'usuario' ? 'Voc√™' : 'NexusBot' }}:</strong> {{ msg.text }}</p>
          }
        }
      </div>

  <!-- popover de selecao para a conversa -->
      @if (showPopup) {
        <div id="popup-selecao" class="popup-selecao" [style.left.px]="popupX" [style.top.px]="popupY">
          <div class="popup-botoes">
            <button (mousedown)="$event.preventDefault()" (click)="resumirSelecao()">Resumir</button>
            <button class="vermelho" (mousedown)="$event.preventDefault()" (click)="grifarTexto('vermelho')">Vermelho</button>
            <button class="azul" (mousedown)="$event.preventDefault()" (click)="grifarTexto('azul')">Azul</button>
            <button class="verde" (mousedown)="$event.preventDefault()" (click)="grifarTexto('verde')">Verde</button>
            <button (mousedown)="$event.preventDefault()" (click)="definirSelecao()">Defini√ß√£o</button>
            <button class="fechar" (click)="fecharPopup()" aria-label="fechar">‚úñ</button>
          </div>
        </div>
      }

  <!-- balao flutuante com definicao ou resumo -->
      @if (showBalaoAcao) {
        <div class="balao-definicao" [style.left.px]="balaoX" [style.top.px]="balaoY">
          <div class="balao-def-topo">
            <span class="titulo-colorido">{{ balaoTitulo }}</span>
            <button class="fechar" (click)="showBalaoAcao=false">‚úñ</button>
          </div>
          <div class="balao-def-corpo">{{ balaoConteudo }}</div>
          @if (balaoSinonimos.length) {
            <div class="balao-def-sins">
              <span>Sin√¥nimos:</span>
              <ul>
                <li *ngFor="let s of balaoSinonimos">{{ s }}</li>
              </ul>
            </div>
          }
        </div>
      }
    </div>

  <!-- area onde digita e envia mensagens -->
  <div class="area-entrada">
      <input
        type="text"
        [(ngModel)]="novaMensagem"
        placeholder="digite uma mensagem"
        (keyup.enter)="mandarMensagem()"
        aria-label="mensagem"
      />
        <button class="botao-enviar" (click)="mandarMensagem()" aria-label="enviar">‚úâÔ∏è</button>
    </div>
  </main>
</div>
